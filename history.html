<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Orders</title>
<style>
body { font-family: Arial, Helvetica, sans-serif; background:#0f1115; color:#e7eaf0; padding:10px; }
h2 { text-align:center; color:#06b6d4; margin-bottom:20px; }
table { width:100%; border-collapse: collapse; margin-bottom:20px; display:none; }
th, td { padding:8px; text-align:center; border:1px solid #333; }
th { background:#1f2937; color:#06b6d4; }
td { background:#171a21; }
.status-pending { color:#facc15; font-weight:bold; }
.status-completed { color:#22c55e; font-weight:bold; }
.status-failed { color:#ef4444; font-weight:bold; }
.msg { text-align:center; margin-top:20px; font-size:16px; color:#06b6d4; }
.loader { text-align:center; font-size:16px; color:#06b6d4; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAyhjOsIXNAkBglpRllt0OZIOJYpdB_9-8",
  authDomain: "diamond-recharge-f7f59.firebaseapp.com",
  projectId: "diamond-recharge-f7f59",
  storageBucket: "diamond-recharge-f7f59.appspot.com",
  messagingSenderId: "657717928489",
  appId: "1:657717928489:web:70431ebc9afb7002d4b238",
  measurementId: "G-TDK78BQ8SQ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.addEventListener("load",()=>{
  const table = document.getElementById("ordersTable");
  const tableBody = document.getElementById("ordersBody");
  const msg = document.getElementById("msg");
  
  msg.textContent = "⏳ Loading orders...";

  onAuthStateChanged(auth, async(user)=>{
    if(user){
      try{
        const q = query(
          collection(db,"orders"),
          where("userId","==",user.uid),
          orderBy("createdAt","desc")
        );
        const snapshot = await getDocs(q);
        if(snapshot.empty){
          msg.textContent = "No orders yet.";
        } else {
          snapshot.forEach(doc=>{
            const data = doc.data();
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${data.profileId || "-"}</td>
              <td>${data.amount || "-"}</td>
              <td>${data.method || "-"}</td>
              <td>${data.account || "-"}</td>
              <td>${data.txid || "-"}</td>
              <td class="status-${data.status.toLowerCase()}">${data.status || "-"}</td>
              <td>${data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString() : "-"}</td>
            `;
            tableBody.appendChild(tr);
          });
          msg.textContent = "";
          table.style.display = "table"; // table দেখানো
        }
      }catch(e){
        msg.textContent = "Error: "+e.message;
      }
    }else{
      alert("Please login first");
      window.location.href="login.html";
    }
  });
});
</script>
</head>
<body>
<h2>💎 My Order History</h2>
<table id="ordersTable">
<thead>
<tr>
  <th>Profile ID</th>
  <th>Amount</th>
  <th>Method</th>
  <th>Account</th>
  <th>TXID</th>
  <th>Status</th>
  <th>Created At</th>
</tr>
</thead>
<tbody id="ordersBody">
</tbody>
</table>
<p id="msg" class="msg"></p>
</body>
</html>
