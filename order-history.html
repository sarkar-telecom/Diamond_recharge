<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order History - SARKAR TELECOM</title>
<link rel="icon" type="image/png" href="images/favicon.png">

<style>
/* ================= BODY ================= */
body {
  margin:0;
  font-family: Arial,sans-serif;
  background:#0f1824;
  color:#fff;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

/* ================= HEADER ================= */
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#1b2735;
  padding:10px 15px;
  position:fixed;
  width:100%;
  top:0;
  z-index:1000;
}
.menu-toggle { font-size:24px; cursor:pointer; background:none; border:none; color:#fff; }
.site-title { font-weight:bold; font-size:18px; flex:1; text-align:center; }
.profile { position:relative; cursor:pointer; display:flex; align-items:center; padding-right:30px; }
.profile img { width:40px; height:40px; border-radius:50%; object-fit:cover; margin-left:10px; }
.dropdown { position:absolute; right:0; top:50px; background:#1c2431; color:#fff; min-width:180px; border-radius:8px; display:none; flex-direction:column; box-shadow:0 4px 6px rgba(0,0,0,0.2); z-index:1001; }
.dropdown a { padding:10px; text-decoration:none; color:#fff; border-bottom:1px solid #2a3445; display:block; }
.dropdown a:hover { background:#2f3c52; }

/* ================= SIDEBAR ================= */
.sidebar { position:fixed; left:-250px; top:0; width:250px; height:100%; background:#1c2431; padding-top:60px; transition:left 0.3s ease; z-index:999; overflow-y:auto; }
.sidebar.active { left:0; }
.sidebar a { display:block; padding:12px 20px; text-decoration:none; color:#fff; border-bottom:1px solid #2a3445; font-size:14px; }
.sidebar a:hover { background:#2f3c52; }

/* ================= LOGOUT BUTTON ================= */
.logout-btn { display:block; width:90%; margin:15px auto; padding:12px; background:#d62828; color:#fff; border:none; border-radius:8px; font-size:15px; cursor:pointer; text-align:center; }
.logout-btn:hover { background:#b91c1c; }

/* ================= MAIN ================= */
main { margin-top:70px; padding:15px; margin-left:0; flex:1; transition:margin-left 0.3s ease; }

/* ================= USER CARD ================= */
.user-card { background:#0f1115; border:1px solid #2b3347; border-radius:12px; padding:10px; display:flex; align-items:center; gap:10px; margin:15px; flex-direction:column; text-align:center; }
.user-card img { width:70px; height:70px; border-radius:50%; border:3px solid #06b6d4; object-fit:cover; }
.user-card h3 { margin:4px 0; font-size:16px; color:#06b6d4; }
.user-card p { margin:2px 0; font-size:13px; color:#fff; }

/* ================= SEARCH & TABLE ================= */
#searchBox { width:100%; padding:8px; margin-bottom:10px; border-radius:6px; border:1px solid #333; background:#171a21; color:#fff; box-sizing:border-box; }
table { width:100%; border-collapse:collapse; table-layout:fixed; }
th, td { padding:6px 8px; border:1px solid #333; text-align:center; font-size:12px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
th { background:#1f2937; }
td { background:#171a21; }
.status-pending { color:#facc15; font-weight:bold; }
.status-completed { color:#22c55e; font-weight:bold; }
.status-failed, .status-cancelled { color:#ef4444; font-weight:bold; }
.pagination { text-align:center; margin-top:10px; }
.pagination button { margin:2px; padding:4px 6px; border:none; border-radius:6px; cursor:pointer; background:#1f2937; color:#fff; font-size:12px; }
.pagination button.active { background:#06b6d4; color:#000; }
.pagination button:hover { background:#2f3c52; }

/* ================= FOOTER ================= */
footer {
  background:#1b2735;
  padding:20px 15px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  flex-wrap:nowrap; /* keep 3 columns in one line */
  gap:15px;
  flex-shrink:0;
}

.footer-wrapper {
  display:flex;
  justify-content:space-between;
  flex:1;
  flex-wrap:nowrap; /* keep 3 columns in one line */
}

.footer-section {
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width:120px;
  flex:1; /* proportional width */
}

.footer-section a {
  text-decoration:none;
  color:#fff;
  font-size:14px;
  transition:0.3s;
}

.footer-section a:hover { color:#06b6d4; }

.footer-branding p { margin:2px 0; font-size:13px; color:#ccc; }

/* ================= RESPONSIVE ================= */
@media(max-width:768px){
  footer, .footer-wrapper {
    flex-wrap:nowrap; /* tetap 3 columns even on mobile */
    overflow-x:auto; /* allow horizontal scroll if needed */
  }
  .footer-section {
    min-width:120px; /* keep columns visible */
    flex:0 0 auto; /* maintain width */
  }
 }
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, collection, query, where, orderBy, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAyhjOsIXNAkBglpRllt0OZIOJYpdB_9-8",
  authDomain: "diamond-recharge-f7f59.firebaseapp.com",
  projectId: "diamond-recharge-f7f59",
  storageBucket: "diamond-recharge-f7f59.appspot.com",
  messagingSenderId: "657717928489",
  appId: "1:657717928489:web:70431ebc9afb7002d4b238",
  measurementId: "G-TDK78BQ8SQ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ================= SIDEBAR TOGGLE & DROPDOWN =================
document.addEventListener("DOMContentLoaded", ()=>{
  const sidebar = document.getElementById("sidebar");
  const profileMenu = document.getElementById("profileMenu");
  const dropdownMenu = document.getElementById("dropdownMenu");

  document.querySelector(".menu-toggle").addEventListener("click", ()=>{
    sidebar.classList.toggle("active");
  });

  profileMenu.addEventListener("click", ()=>{
    dropdownMenu.style.display = dropdownMenu.style.display==="flex"?"none":"flex";
  });
});

// ================= LOGOUT =================
function doLogout(){ signOut(auth).then(()=>window.location.href="login.html"); }
document.addEventListener("DOMContentLoaded", ()=>{
  const btn1 = document.getElementById("logoutBtn");
  const btn2 = document.getElementById("logoutBtn2");
  btn1 && btn1.addEventListener("click", doLogout);
  btn2 && btn2.addEventListener("click", doLogout);
});

// ================= ORDERS =================
let allOrders=[], currentPage=1, perPage=20;
function formatTime(ts){ 
  if(!ts?.toDate) return "-"; 
  const d=ts.toDate(); 
  let h=d.getHours(); 
  const m=d.getMinutes().toString().padStart(2,'0'); 
  const ampm=h>=12?'PM':'AM'; 
  h=h%12||12; 
  return `${h}:${m} ${ampm}`; 
}
function renderTable(orders){ 
  const tbody=document.getElementById("ordersBody"); 
  tbody.innerHTML=""; 
  const total=allOrders.length; 
  orders.forEach((d,i)=>{ 
    const sl=total-((currentPage-1)*perPage+i); 
    const tr=document.createElement("tr"); 
    tr.innerHTML=`<td>${sl}</td>
      <td>${d.profileId||"-"}</td>
      <td>${d.amount||"-"}</td>
      <td>${d.method||"-"}</td>
      <td>${d.account||"-"}</td>
      <td>${d.txid||"-"}</td>
      <td class="status-${d.status?.toLowerCase()||"pending"}">${d.status||"-"}</td>
      <td>${formatTime(d.createdAt)}</td>`;
    tbody.appendChild(tr); 
  }); 
}
function renderPagination(total){ 
  const pag=document.getElementById("pagination"); 
  pag.innerHTML=""; 
  const pages=Math.ceil(total/perPage); 
  if(pages<=1) return; 
  for(let i=1;i<=pages;i++){ 
    const btn=document.createElement("button"); 
    btn.textContent=i; 
    btn.className=i===currentPage?"active":""; 
    btn.onclick=()=>{ currentPage=i; showPage(); }; 
    pag.appendChild(btn); 
  } 
}
function showPage(){ 
  const s=(currentPage-1)*perPage; 
  renderTable(allOrders.slice(s,s+perPage)); 
  renderPagination(allOrders.length); 
}
function filterOrders(){ 
  const q=document.getElementById("searchBox").value.toLowerCase(); 
  const filtered=allOrders.filter(o=>((o.profileId||"").toLowerCase().includes(q)||(o.amount||"").toString().includes(q)||(o.method||"").toLowerCase().includes(q)||(o.account||"").toLowerCase().includes(q)||(o.txid||"").toLowerCase().includes(q)||(o.status||"").toLowerCase().includes(q))); 
  renderTable(filtered.slice(0,perPage)); 
  currentPage=1; 
  renderPagination(filtered.length); 
}
document.addEventListener("DOMContentLoaded", ()=>{
  document.getElementById("searchBox").addEventListener("input", filterOrders);
});

// ================= LOAD USER & ORDERS =================
onAuthStateChanged(auth, async(user)=>{
  if(user){
    const userDoc = doc(db,"users",user.uid);
    const snap = await getDoc(userDoc);
    const img=document.getElementById("profilePic");
    if(snap.exists() && snap.data().avatar){ img.src = snap.data().avatar; }
    else{ img.src="https://via.placeholder.com/40"; }

    const userBox = document.getElementById("userBox");
    const avatar = snap.exists() && snap.data().avatar ? snap.data().avatar : "https://via.placeholder.com/70";
    const name = snap.exists() && snap.data().name ? snap.data().name : user.displayName || "Guest";
    const role = snap.exists() && snap.data().role ? snap.data().role : "User";
    const phone = snap.exists() && snap.data().phone ? snap.data().phone : "";
    const email = user.email;
    const balance = snap.exists() && snap.data().balance ? snap.data().balance : 0;
    userBox.innerHTML=`
      <img src="${avatar}" alt="Avatar">
      <h3>${name}</h3>
      <p>${role}</p>
      <p>${phone}</p>
      <p>${email}</p>
      <p>Balance: ${balance}</p>
    `;

    // Load Orders
    const ordersRef = collection(db,"orders");
    const q = query(ordersRef, where("userId","==",user.uid), orderBy("createdAt","desc"));
    const snapshot = await getDocs(q);
    allOrders=[];
    snapshot.forEach(d=>allOrders.push(d.data()));
    showPage();
  }else window.location.href="login.html";
});
</script>
</head>
<body>

<!-- HEADER -->
<header>
  <button class="menu-toggle">☰</button>
  <div class="site-title">SARKAR TELECOM</div>
  <div class="profile" id="profileMenu">
    <img id="profilePic" src="https://via.placeholder.com/40" alt="Profile">
    <div class="dropdown" id="dropdownMenu">
      <a href="profile.html">⚙️ Profile</a>
      <a href="order.html">➕ Order</a>
      <a href="order-history.html">📜 History</a>
      <a href="#" id="logoutBtn">🚪 Logout</a>
    </div>
  </div>
</header>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <a href="index.html">🏠 Home</a>
  <a href="dashboard.html">📊 Dashboard</a>
  <a href="profile.html">⚙️ Profile</a>
  <a href="order.html">➕ Order</a>
  <a href="order-history.html">📜 History</a>
  <a href="admin.html">🛠 Admin Panel</a>
  <button id="logoutBtn2" class="logout-btn">🚪 Logout</button>
  <div class="user-card" id="userBox">Loading user...</div>
</div>

<!-- MAIN CONTENT -->
<main>
  <input type="text" id="searchBox" placeholder="Search Profile ID / Amount / Method / Account / TXID / Status">
  <table>
    <thead>
      <tr>
        <th>SL</th>
        <th>Profile ID</th>
        <th>Amount</th>
        <th>Method</th>
        <th>Account</th>
        <th>TXID</th>
        <th>Status</th>
        <th>Created At</th>
      </tr>
    </thead>
    <tbody id="ordersBody"></tbody>
  </table>
  <div class="pagination" id="pagination"></div>
</main>

<!-- FOOTER -->
<footer>
  <div class="footer-wrapper">
    <div class="footer-section">
      <strong>Support</strong>
      <a href="support.html">💬 Support</a>
      <a href="faq.html">❓ FAQ</a>
      <a href="sitemap.html">🌐 Sitemap</a>
    </div>
    
    <div class="footer-section">
      <strong>Information</strong>
      <a href="about.html">ℹ️ About Us</a>
      <a href="privacy.html">🔒 Privacy Policy</a>
      <a href="terms.html">📄 Terms & Conditions</a>
      <a href="refund.html">💎 Refund Policy</a>
    </div>
    
    <div class="footer-section footer-branding">
      <strong>SARKAR TELECOM</strong>
      <p>Fast & Secure Mobile Recharge Service</p>
      <p>© 2025 All Rights Reserved ®</p>
    </div>
  </div>
</footer>

</body>
</html>