<!DOCTYPE html><html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order History - Diamond Recharge</title>
<style>
body{font-family:Arial,sans-serif;background:#0f1115;color:#e7eaf0;margin:0;padding:20px;}
.container{max-width:900px;margin:auto;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{padding:10px;border:1px solid #333;text-align:center;}
th{background:#171a21;}
td{background:#1f2937;}
.status-pending{color:#facc15;font-weight:bold;}
.status-completed{color:#4ade80;font-weight:bold;}
.status-cancelled{color:#f87171;font-weight:bold;}
button{margin:5px;padding:10px 20px;border:none;border-radius:6px;background:#06b6d4;color:#001;cursor:pointer;}
button:hover{background:#0ea5e9;}
</style>
</head>
<body>
<div class="container">
<h2>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h2>
<table id="ordersTable">
  <thead>
    <tr>
      <th>Diamonds</th>
      <th>Price (‡ß≥)</th>
      <th>Profile ID</th>
      <th>Payment Method</th>
      <th>Payment Number</th>
      <th>TRX ID</th>
      <th>Status</th>
      <th>Timestamp</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<button onclick="logout()">Logout</button>
</div><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script><script>
const firebaseConfig = {
  apiKey: "AIzaSyAyhjOsIXNAkBglpRllt0OZIOJYpdB_9-8",
  authDomain: "diamond-recharge-f7f59.firebaseapp.com",
  projectId: "diamond-recharge-f7f59",
  storageBucket: "diamond-recharge-f7f59.firebasestorage.app",
  messagingSenderId: "657717928489",
  appId: "1:657717928489:web:70431ebc9afb7002d4b238",
  measurementId: "G-TDK78BQ8SQ"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUserUid = null;

auth.onAuthStateChanged(async user => {
  if(user){
    currentUserUid = user.uid;
    await loadUserOrders(currentUserUid);
  } else {
    window.location.href = 'index.html';
  }
});

const tableBody = document.querySelector('#ordersTable tbody');

async function loadUserOrders(uid){
  tableBody.innerHTML = 'Loading...';
  try {
    const querySnapshot = await db.collection('orders')
      .where('userId', '==', uid)
      .orderBy('createdAt', 'desc')
      .get();

    tableBody.innerHTML = '';

    if(querySnapshot.empty){
      tableBody.innerHTML = '<tr><td colspan="8">No orders yet</td></tr>';
      return;
    }

    querySnapshot.forEach(doc => {
      const data = doc.data();
      const statusClass = data.status.toLowerCase();
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${data.diamonds || ''} üíé</td>
        <td>${data.amount || data.price || ''} ‡ß≥</td>
        <td>${data.profileId || ''}</td>
        <td>${data.method || ''}</td>
        <td>${data.account || ''}</td>
        <td>${data.txid || ''}</td>
        <td class="status-${statusClass}">${data.status}</td>
        <td>${data.createdAt ? new Date(data.createdAt).toLocaleString() : ''}</td>
      `;
      tableBody.appendChild(tr);
    });
  } catch(err){
    console.error(err);
    tableBody.innerHTML = '<tr><td colspan="8">Error loading orders</td></tr>';
  }
}

function logout(){
  auth.signOut().then(()=>window.location.href='index.html');
}
</script></body>
</html>