<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - IMO Diamond</title>
<style>
body{font-family:Arial,sans-serif;background:#0f1115;color:#e7eaf0;margin:0;padding:20px;}
.container{max-width:900px;margin:auto;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{padding:10px;border:1px solid #333;text-align:center;}
th{background:#171a21;}
td{background:#1f2937;}
button{margin:2px;padding:5px 10px;border:none;border-radius:6px;background:#06b6d4;color:#001;cursor:pointer;}
button:hover{background:#0ea5e9;}
input, select{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:1px solid #333;background:#0f1115;color:#e7eaf0;}
.status-Pending{color:#facc15;font-weight:bold;}
.status-Completed{color:#4ade80;font-weight:bold;}
.status-Rejected{color:#f87171;font-weight:bold;}
.copy-box{background:#171a21;padding:5px;border-radius:6px;margin:5px 0;cursor:pointer;}
</style>
</head>
<body>
<div class="container">
<h2>Admin Panel</h2>

<h3>Update Payment Numbers</h3>
<label>Payment Method:</label>
<select id="adminPaymentMethod">
  <option value="">Select Payment Method</option>
  <option value="bKash">bKash</option>
  <option value="Nagad">Nagad</option>
  <option value="Rocket">Rocket</option>
  <option value="Upay">Upay</option>
</select>

<label>Numbers (comma separated):</label>
<input type="text" id="adminPaymentNumbers" placeholder="e.g. 01715118684,01781332352">
<button onclick="updatePaymentNumbers()">Update</button>

<h3>Orders Management</h3>
<table id="ordersTable">
<thead>
<tr>
  <th>User ID</th>
  <th>Diamonds</th>
  <th>Price</th>
  <th>Profile ID</th>
  <th>Payment Method</th>
  <th>Payment Number</th>
  <th>TRX ID</th>
  <th>Status</th>
  <th>Action</th>
  <th>Timestamp</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button onclick="logout()">Logout</button>
<p id="msg"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAyhjOsIXNAkBglpRllt0OZIOJYpdB_9-8",
  authDomain: "diamond-recharge-f7f59.firebaseapp.com",
  projectId: "diamond-recharge-f7f59",
  storageBucket: "diamond-recharge-f7f59.firebasestorage.app",
  messagingSenderId: "657717928489",
  appId: "1:657717928489:web:70431ebc9afb7002d4b238",
  measurementId: "G-TDK78BQ8SQ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUserUid = null;

onAuthStateChanged(auth,user=>{
  if(user) currentUserUid=user.uid;
  else window.location.href="index.html";
  loadOrders();
});

const tableBody = document.querySelector("#ordersTable tbody");
const msgEl = document.getElementById("msg");

async function loadOrders(){
  tableBody.innerHTML="Loading...";
  const querySnapshot = await getDocs(collection(db,"orders"));
  tableBody.innerHTML="";
  if(querySnapshot.empty){
    tableBody.innerHTML="<tr><td colspan='10'>No orders yet</td></tr>";
    return;
  }
  querySnapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${data.userId}</td>
      <td>${data.diamonds} üíé</td>
      <td>${data.price} ‡ß≥</td>
      <td>${data.profileId}</td>
      <td>${data.paymentMethod}</td>
      <td>${data.paymentNumber}</td>
      <td>${data.trxId}</td>
      <td class="status-${data.status}">${data.status}</td>
      <td>
        <button onclick="updateStatus('${docSnap.id}','Completed')">‚úÖ</button>
        <button onclick="updateStatus('${docSnap.id}','Rejected')">‚ùå</button>
      </td>
      <td>${data.timestamp?.toDate().toLocaleString()||""}</td>
    `;
    tableBody.appendChild(tr);
  });
}

window.updateStatus=async(id,status)=>{
  await updateDoc(doc(db,"orders",id),{status:status});
  msgEl.textContent=`Order status updated to ${status}`;
  loadOrders();
}

// Payment Numbers Update
window.updatePaymentNumbers=()=>{
  const method=document.getElementById("adminPaymentMethod").value;
  const numbers=document.getElementById("adminPaymentNumbers").value.trim().split(",");
  if(!method || numbers.length===0){ msgEl.textContent="‚ö†Ô∏è Fill all fields"; return; }
  // Save to Firestore (we can have a document 'paymentNumbers')
  updateDoc(doc(db,"admin","paymentNumbers"),{[method]:numbers}).then(()=>{
    msgEl.textContent="‚úÖ Payment numbers updated!";
  }).catch(e=>msgEl.textContent="‚ùå "+e.message);
}

window.logout=()=>{ signOut(auth).then(()=>window.location.href="index.html"); }
</script>
</body>
</html>