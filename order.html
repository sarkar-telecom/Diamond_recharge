<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Diamonds - SARKAR TELECOM</title>
<link rel="icon" type="image/png" href="images/favicon.png">
<style>
body { margin:0; font-family:Arial,sans-serif; background:#0f1824; color:#fff; display:flex; flex-direction:column; min-height:100vh; }
header { display:flex; justify-content:space-between; align-items:center; background:#1b2735; padding:10px 15px; position:fixed; width:100%; top:0; z-index:1000; }
.menu-toggle { font-size:24px; cursor:pointer; background:none; border:none; color:#fff; }
.site-title { font-weight:bold; font-size:18px; flex:1; text-align:center; }
.profile { position:relative; cursor:pointer; display:flex; align-items:center; padding-right:30px; }
.profile img { width:40px; height:40px; border-radius:50%; object-fit:cover; margin-left:10px; }
.dropdown { position:absolute; right:0; top:50px; background:#1c2431; color:#fff; min-width:180px; border-radius:8px; display:none; flex-direction:column; box-shadow:0 4px 6px rgba(0,0,0,0.2); z-index:1001; }
.dropdown a { padding:10px; text-decoration:none; color:#fff; border-bottom:1px solid #2a3445; display:block; }
.dropdown a:hover { background:#d62828; }
.sidebar { position:fixed; left:-250px; top:0; width:250px; height:100%; background:#1c2431; padding-top:60px; transition:left 0.3s ease; z-index:999; overflow-y:auto; }
.sidebar.active { left:0; }
.sidebar a { display:block; padding:12px 20px; text-decoration:none; color:#fff; border-bottom:1px solid #2a3445; font-size:14px; }
.sidebar a:hover { background:#2f3c52; }
.logout-btn { display:block; width:90%; margin:15px auto; padding:12px; background:#d62828; color:#fff; border:none; border-radius:8px; font-size:15px; cursor:pointer; text-align:center; }
.logout-btn:hover { background:#b91c1c; }
.user-card { background:#0f1115; border:1px solid #2b3347; border-radius:12px; padding:10px; display:flex; flex-direction:column; align-items:center; gap:6px; margin:15px; text-align:center; }
.user-card img { width:70px; height:70px; border-radius:50%; border:3px solid #06b6d4; object-fit:cover; }
.user-card h3 { margin:4px 0; font-size:16px; color:#06b6d4; }
.user-card p { margin:2px 0; font-size:13px; color:#fff; }
main { margin-top:70px; padding:15px; flex:1; }
h2 { text-align:center; color:#06b6d4; margin-bottom:20px; }
.grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(80px,1fr)); gap:10px; margin-bottom:10px; }
.grid button { padding:10px; border:none; border-radius:6px; cursor:pointer; background:#1f2937; color:#e7eaf0; font-weight:bold; }
.grid button.selected { background:#06b6d4; color:#000; }
input, select { width:100%; padding:8px; margin:6px 0; border-radius:6px; border:1px solid #333; background:#171a21; color:#e7eaf0; }
button#submitBtn { width:100%; padding:10px; border:none; border-radius:6px; background:#06b6d4; color:#000; font-weight:bold; cursor:pointer; margin-top:10px; }
button#submitBtn:hover { background:#0ea5e9; }
button#submitBtn:disabled { background:#555; cursor:not-allowed; }
.copy-box { display:flex; gap:5px; align-items:center; margin-bottom:10px; }
.copy-box input { flex:1; }
.copy-box button { padding:6px; border:none; border-radius:6px; cursor:pointer; background:#06b6d4; color:#000; }
.msg { margin-top:10px; font-size:14px; min-height:20px; }
.amount-display { margin-bottom:10px; font-weight:bold; text-align:center; }
footer { background:#1b2735; padding:20px 15px; display:flex; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; gap:15px; flex-shrink:0; }
.footer-section { display:flex; flex-direction:column; gap:6px; }
.footer-section a { text-decoration:none; color:#fff; font-size:14px; transition:0.3s; }
.footer-section a:hover { color:#06b6d4; }
.footer-branding p { margin:2px 0; font-size:13px; color:#ccc; }
@media(max-width:768px){ main { padding:10px; } footer { flex-direction:column; gap:10px; } .footer-section { flex:1; } }
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAyhjOsIXNAkBglpRllt0OZIOJYpdB_9-8",
  authDomain: "diamond-recharge-f7f59.firebaseapp.com",
  projectId: "diamond-recharge-f7f59",
  storageBucket: "diamond-recharge-f7f59.appspot.com",
  messagingSenderId: "657717928489",
  appId: "1:657717928489:web:70431ebc9afb7002d4b238",
  measurementId: "G-TDK78BQ8SQ"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const diamondAmounts = [{d:10,p:25},{d:50,p:115},{d:100,p:230},{d:200,p:460},{d:500,p:1130},{d:1000,p:2250},{d:2000,p:4500},{d:5000,p:11200},{d:10000,p:22200},{d:20000,p:44000}];
const paymentMethods = {"bKash Personal":["01715118684","01781332352","01790216921","01405475992"],"Nagad Personal":["01715118684","01790216921"],"Rocket Personal":["017151186847"],"Upay Personal":["01715118684"],"Nagad Agent":["01919961919"],"bKash Payment":["01971744060","01911611637"],"Binance (USDT)":["216953638"]};
let selectedAmount=null, selectedPaymentMethod=null, selectedAccount=null;

document.addEventListener("DOMContentLoaded",()=>{
  const sidebar = document.getElementById("sidebar");
  const profileMenu = document.getElementById("profileMenu");
  const dropdownMenu = document.getElementById("dropdownMenu");

  document.querySelector(".menu-toggle").addEventListener("click", ()=>{ sidebar.classList.toggle("active"); });
  profileMenu.addEventListener("click", ()=>{ dropdownMenu.style.display = dropdownMenu.style.display==="block"?"none":"block"; });
  document.getElementById("logoutBtn").addEventListener("click", doLogout);
  document.getElementById("logoutBtn2").addEventListener("click", doLogout);

  const grid = document.getElementById("diamondGrid");
  diamondAmounts.forEach(a=>{
    const btn = document.createElement("button");
    btn.textContent = `${a.d} ğŸ’`;
    btn.onclick = ()=>selectAmount(a,btn);
    grid.appendChild(btn);
  });

  const methodSelect = document.getElementById("paymentMethod");
  Object.keys(paymentMethods).forEach(m=>{
    const opt = document.createElement("option"); opt.value = m; opt.textContent = m;
    methodSelect.appendChild(opt);
  });
  methodSelect.addEventListener("change", ()=>{ selectedPaymentMethod=methodSelect.value; showAccount(selectedPaymentMethod); });

  document.getElementById("profileId").addEventListener("input",(e)=>{ e.target.value=e.target.value.replace(/[^0-9\+]/g,''); });
});

function doLogout(){ signOut(auth).then(()=>window.location.href="login.html"); }

function selectAmount(a,btn){
  selectedAmount=a;
  document.querySelectorAll("#diamondGrid button").forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
  document.getElementById("amountDisplay").textContent=`Amount: ${a.p} /-`;
}

function showAccount(method){
  const accountBox=document.getElementById("accountBox");
  accountBox.innerHTML="";
  if(!method||!paymentMethods[method]) return;
  selectedAccount=paymentMethods[method][0];
  if(paymentMethods[method].length>1){
    const select = document.createElement("select");
    paymentMethods[method].forEach(acc=>{ const opt=document.createElement("option"); opt.value=acc; opt.textContent=acc; select.appendChild(opt); });
    select.addEventListener("change",()=>selectedAccount=select.value);
    accountBox.appendChild(select);
  }else{
    const copyDiv = document.createElement("div"); copyDiv.className="copy-box";
    const input = document.createElement("input"); input.value=selectedAccount; input.readOnly=true;
    const copyBtn = document.createElement("button"); copyBtn.textContent="Copy"; copyBtn.onclick=()=>{ navigator.clipboard.writeText(selectedAccount); alert("Copied: "+selectedAccount); };
    copyDiv.appendChild(input); copyDiv.appendChild(copyBtn);
    accountBox.appendChild(copyDiv);
  }
}

window.submitOrder=async()=>{
  const profileId=document.getElementById("profileId").value.trim();
  const txid=document.getElementById("txid").value.trim();
  const msg=document.getElementById("msg");
  const submitBtn=document.getElementById("submitBtn");

  if(!selectedAmount){ msg.textContent="âš ï¸ Select Diamond amount"; return;}
  if(!profileId){ msg.textContent="âš ï¸ Enter Profile ID / Number"; return;}
  if(!selectedPaymentMethod){ msg.textContent="âš ï¸ Select Payment Method"; return;}
  if(!txid){ msg.textContent="âš ï¸ Enter Transaction ID"; return;}

  submitBtn.disabled=true;

  onAuthStateChanged(auth, async(user)=>{
    if(user){
      try{
        await addDoc(collection(db,"orders"),{
          email:user.email,
          profileId,
          amount:selectedAmount.p,
          method:selectedPaymentMethod,
          account:selectedAccount,
          txid,
          status:"pending",
          createdAt:serverTimestamp(),
          userId:user.uid
        });
        msg.textContent="âœ… Order submitted!";
        setTimeout(()=>window.location.href="order-history.html",1000);
      }catch(e){ msg.textContent="âŒ "+e.message; submitBtn.disabled=false; }
    } else { window.location.href="login.html"; }
  });
}

onAuthStateChanged(auth, async(user)=>{
  if(user){
    const userDoc=doc(db,"users",user.uid);
    const snap=await getDoc(userDoc);
    const data = snap.exists()?snap.data():{};
    const avatar = data.avatar || user.photoURL || "https://via.placeholder.com/70";
    const name = data.name || user.displayName || "Guest User";
    const role = data.role || "User";
    const phone = data.phone || "N/A";
    const email = user.email || "";
    const balance = data.balance!==undefined?data.balance:"0";
    document.getElementById("profilePic").src = avatar;
    document.getElementById("userBox").innerHTML = `<img src="${avatar}" alt="Avatar"><h3>${name}</h3><p>ğŸ§–â€â™‚ï¸ Role: ${role}</p><p>ğŸ“ ${phone}</p><p>âœ‰ ${email}</p><p>ğŸ’ Balance: ${balance}</p>`;
  }else{ window.location.href="login.html"; }
});
</script>
</head>

<body>
<header>
  <button class="menu-toggle">â˜°</button>
  <div class="site-title">SARKAR TELECOM</div>
  <div class="profile" id="profileMenu">
    <img id="profilePic" src="https://via.placeholder.com/40" alt="Profile">
    <div class="dropdown" id="dropdownMenu">
      <a href="profile.html">âš™ï¸ Profile</a>
      <a href="order.html">â• Order</a>
      <a href="order-history.html">ğŸ“œ History</a>
      <a href="#" id="logoutBtn">ğŸšª Logout</a>
    </div>
  </div>
</header>

<div class="sidebar" id="sidebar">
  <a href="index.html">ğŸ  Home</a>
  <a href="dashboard.html">ğŸ“Š Dashboard</a>
  <a href="profile.html">âš™ï¸ Profile</a>
  <a href="order.html">â• Order</a>
  <a href="order-history.html">ğŸ“œ History</a>
  <a href="admin.html">ğŸ›  Admin Panel</a>
  <button id="logoutBtn2" class="logout-btn">ğŸšª Logout</button>
  <div class="user-card" id="userBox">Loading user...</div>
</div>

<main>
  <h2>ğŸ’ Order Diamonds</h2>
  <div id="diamondGrid" class="grid"></div>
  <div id="amountDisplay" class="amount-display"></div>

  <label>Profile ID / Phone Number</label>
  <input type="text" id="profileId" placeholder="Enter Profile ID / Phone Number">

  <label>Payment Method</label>
  <select id="paymentMethod"><option value="">Select Method</option></select>
  <div id="accountBox"></div>

  <label>Transaction ID</label>
  <input type="text" id="txid" placeholder="Enter Transaction ID">

  <button id="submitBtn" onclick="submitOrder()">Submit Order</button>
  <p class="msg" id="msg"></p>
</main>


<!-- FOOTER -->
<footer>
  <div class="footer-wrapper">
    <div class="footer-section">
      <strong>Support</strong>
      <a href="support.html">ğŸ’¬ Support</a>
      <a href="faq.html">â“ FAQ</a>
      <a href="sitemap.html">ğŸŒ Sitemap</a>
    </div>
    
    <div class="footer-section">
      <strong>Information</strong>
      <a href="about.html">â„¹ï¸ About Us</a>
      <a href="privacy.html">ğŸ”’ Privacy Policy</a>
      <a href="terms.html">ğŸ“„ Terms & Conditions</a>
      <a href="refund.html">ğŸ’ Refund Policy</a>
    </div>
    
    <div class="footer-section footer-branding">
      <strong>SARKAR TELECOM</strong>
      <p>Fast & Secure Mobile Recharge Service</p>
      <p>Â© 2025 All Rights Reserved Â®</p>
    </div>
  </div>
</footer>
</body>
</html>