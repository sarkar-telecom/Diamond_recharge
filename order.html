<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ›’ New Order</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#0f1115;color:#e7eaf0;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;padding:20px;}
    .card{background:#171a21;padding:24px;border-radius:16px;width:100%;max-width:420px;box-shadow:0 4px 14px rgba(0,0,0,0.6);}
    h2{text-align:center;color:#06b6d4;margin-bottom:20px;}
    input,select{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #333;background:#0f1115;color:#e7eaf0;}
    .amount-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin:15px 0;}
    .amount-grid button{background:#1f2937;color:#e7eaf0;padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:0.2s;}
    .amount-grid button:hover{background:#06b6d4;color:#000;}
    .amount-grid button.active{background:#06b6d4;color:#000;}
    .pay-number{background:#1f2937;padding:10px;border-radius:6px;margin:10px 0;text-align:center;user-select:all;}
    .submit-btn{background:#06b6d4;color:#000;font-weight:bold;border:none;padding:12px;width:100%;border-radius:8px;cursor:pointer;margin-top:15px;}
    .submit-btn:hover{background:#0ea5e9;}
    .msg{text-align:center;margin-top:10px;font-size:14px;min-height:20px;}
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ›’ New Order</h2>

    <!-- Profile ID -->
    <input type="text" id="profileId" placeholder="Enter Profile ID / Number">

    <!-- Amount Buttons -->
    <div class="amount-grid">
      <button onclick="selectAmount(10,25)">10 ğŸ’ (25à§³)</button>
      <button onclick="selectAmount(50,115)">50 ğŸ’ (115à§³)</button>
      <button onclick="selectAmount(100,230)">100 ğŸ’ (230à§³)</button>
      <button onclick="selectAmount(200,460)">200 ğŸ’ (460à§³)</button>
      <button onclick="selectAmount(500,1130)">500 ğŸ’ (1130à§³)</button>
      <button onclick="selectAmount(1000,2250)">1000 ğŸ’ (2250à§³)</button>
      <button onclick="selectAmount(2000,4500)">2000 ğŸ’ (4500à§³)</button>
      <button onclick="selectAmount(5000,11200)">5000 ğŸ’ (11200à§³)</button>
      <button onclick="selectAmount(10000,22200)">10000 ğŸ’ (22200à§³)</button>
      <button onclick="selectAmount(20000,44000)">20000 ğŸ’ (44000à§³)</button>
    </div>
    <p id="selectedAmount">âš ï¸ Please select an amount</p>

    <!-- Payment Method -->
    <select id="paymentMethod" onchange="updateNumbers()">
      <option value="">-- Select Payment Method --</option>
      <option value="bkash">bKash</option>
      <option value="nagad">Nagad</option>
      <option value="rocket">Rocket</option>
      <option value="upay">Upay</option>
    </select>

    <!-- Number Dropdown -->
    <select id="paymentNumber"></select>

    <!-- Copy Box -->
    <div class="pay-number" id="copyBox">ğŸ“± Select method & number</div>

    <!-- TRX ID -->
    <input type="text" id="trxid" placeholder="Enter Transaction ID">

    <button class="submit-btn" onclick="submitOrder()">âœ… Submit Order</button>
    <p id="msg" class="msg"></p>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAyhjOsIXNAkBglpRllt0OZIOJYpdB_9-8",
      authDomain: "diamond-recharge-f7f59.firebaseapp.com",
      projectId: "diamond-recharge-f7f59",
      storageBucket: "diamond-recharge-f7f59.firebasestorage.app",
      messagingSenderId: "657717928489",
      appId: "1:657717928489:web:70431ebc9afb7002d4b238",
      measurementId: "G-TDK78BQ8SQ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let selectedDiamonds=null;
    let selectedPrice=null;

    // Payment numbers
    const numbers={
      bkash:["01715118684","01781332352","01790216921","01405475992","01971744060","01911611637"],
      nagad:["01715118684","01790216921","01919961919"],
      rocket:["017151186847"],
      upay:["01715118684"]
    };

    // Select amount
    window.selectAmount=(d,p)=>{
      selectedDiamonds=d;selectedPrice=p;
      document.querySelectorAll(".amount-grid button").forEach(b=>b.classList.remove("active"));
      event.target.classList.add("active");
      document.getElementById("selectedAmount").textContent=`âœ… Selected: ${d} ğŸ’ for ${p}à§³`;
    };

    // Update number dropdown
    window.updateNumbers=()=>{
      const method=document.getElementById("paymentMethod").value;
      const numSelect=document.getElementById("paymentNumber");
      const copyBox=document.getElementById("copyBox");
      numSelect.innerHTML="";
      copyBox.textContent="ğŸ“± Select method & number";
      if(numbers[method]){
        numbers[method].forEach(n=>{
          const opt=document.createElement("option");
          opt.value=n; opt.textContent=n;
          numSelect.appendChild(opt);
        });
        copyBox.textContent=numbers[method][0];
      }
    };

    // CopyBox update when number select changes
    document.getElementById("paymentNumber").addEventListener("change",e=>{
      document.getElementById("copyBox").textContent=e.target.value;
    });

    // Submit order
    window.submitOrder=()=>{
      const profileId=document.getElementById("profileId").value.trim();
      const method=document.getElementById("paymentMethod").value;
      const number=document.getElementById("paymentNumber").value;
      const trxid=document.getElementById("trxid").value.trim();
      const msg=document.getElementById("msg");

      if(!profileId||!selectedDiamonds||!selectedPrice||!method||!number||!trxid){
        msg.textContent="âš ï¸ Please fill all fields";return;
      }
      msg.textContent="â³ Submitting order...";

      onAuthStateChanged(auth, async(user)=>{
        if(user){
          await addDoc(collection(db,"orders"),{
            uid:user.uid,
            profileId,
            amount:selectedDiamonds,
            price:selectedPrice,
            method,
            number,
            trxid,
            status:"pending",
            createdAt:serverTimestamp()
          });
          msg.textContent="âœ… Order submitted!";
          setTimeout(()=>window.location.href="order-history.html",1000);
        } else {
          window.location.href="login.html?redirect=order.html";
        }
      });
    };
  </script>
</body>
</html>